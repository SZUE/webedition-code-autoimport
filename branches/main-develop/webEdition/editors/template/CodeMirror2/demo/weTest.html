<!doctype html>
<html>
  <head>
    <title>CodeMirror 2: Overlay Parser Demo</title>
    <link rel="stylesheet" href="../lib/codemirror.css">
    <script src="../lib/codemirror.js"></script>
    <script src="../lib/overlay.js"></script>
    <link rel="stylesheet" href="../mode/xml/xml.css">
    <script src="../mode/xml/xml.js"></script>

		<link rel="stylesheet" href="../mode/javascript/javascript.css">
		<link rel="stylesheet" href="../mode/css/css.css">
		<link rel="stylesheet" href="../mode/clike/clike.css">


		<script src="../mode/javascript/javascript.js"></script>
		<script src="../mode/css/css.js"></script>
		<script src="../mode/htmlmixed/htmlmixed.js"></script>
		<script src="../mode/clike/clike.js"></script>
		<script src="../mode/php/php.js"></script>




    <link rel="stylesheet" href="../css/docs.css">

    <style type="text/css">
      .CodeMirror {border: 1px solid black;}
      .weTag{ font-weight:bold;color:#ff8a00;}
			.weTagAttribute{color:grey;}
			.weSelfClose:hover:after, .weOpenTag:hover:after, .weTagAttribute:hover:after{
				cursor: pointer;
				position: absolute; 
				z-index: 1000;
				white-space: nowrap; 
				background: rgba(0, 0, 0, 0.85); 
				padding: 3px 7px; 
				color: #FFF; 
				border-radius: 3px; 
				-moz-border-radius: 3px; 
				-webkit-border-radius: 3px; 
				margin-left: 7px; 
				margin-top: -3px;
			}
			.weTag_blubber:hover:after { 
				content: "hallo";
			}
			.weTag_test:hover:after { 
				content: "mal was anderes";
			}
			.weTag_test_name:hover:after { 
				content: "Attribute Name ist ein Attribut";
			}

    </style>
  </head>
  <body>
    <h1>CodeMirror 2: Overlay Parser Demo</h1>

    <form><textarea id="code" name="code">


<we:test/>d<we:test>
<we:bla/>
<b>hallo</b>
<we:blubber><a href="">a</a></we:blubber>
   
<we:test name = "hallo" attr2="texts" >hallo</we:test>
<we:test name="hallo" attr2="texts" / > blubber
<we:bla/>
<we:blubber>
							</textarea></form>

							<script>
								CodeMirror.defineMode("text/weTmpl", function(config, parserConfig) {
									var webeditionOverlay = {

										startState: function(){
											return {insideTag: false,
												tagName:"",
												open:false,
												close:false,
												attrActive:false
											};
										},
										token: function(stream, state) {
											if(state.insideTag){
												if(state.close){
													if(stream.skipTo(">")){
														stream.next();
													}
													state.insideTag=false;
													return "weCloseTag weTag";
												}
												if(state.open){
													if(stream.eatSpace())return null;
													if(state.attrActive){
														stream.next();//consume =
														quot=false;
														while ((ch = stream.next()) != null){
															switch(ch){
																case "\\":
																	if(stream.peek()=="\""){
																		stream.next();
																	}
																case "\"":
																	if(quot){
																		state.attrActive=false;
																		return null;
																	}
																	quot=true;
															}
														}
													}else{
														var attrName="";
														state.attrActive=true;
														while ((ch = stream.next()) != null){
															switch(ch){
																default:
																	attrName+=ch;
																	stream.eatSpace();
																	if(stream.peek()=="="){
																		return "weTagAttribute weTag_"+state.tagName+"_"+attrName;
																	}
																	continue;
																case "/":
																	if(stream.skipTo('>')){
																		stream.next();
																	}
																case ">":
																	state.insideTag=false;
																	return "weTag "+attrName;
															}
														}												
													}
												}
												stream.skipToEnd()
												return null;
											}else{
												state.open=stream.match("<we:");
												state.close=!state.open && stream.match("</we:");
												state.attrActive=false;
												if (state.open||state.close) {
													state.insideTag=true;
													state.tagName='';
													while ((ch = stream.next()) != null){
														switch(ch){
															default:
																state.tagName+=ch;
																continue;
															case '/':
																if (state.open && (stream.eatSpace() | stream.peek() == ">")){
																	stream.next();
																	state.insideTag=false;
																	return "weSelfClose weTag weTag_"+state.tagName;
																}
															case '>':
																state.insideTag=false;
																if(state.open){
																	return "weOpenTag weTag weTag_"+state.tagName;
																}
																return "weCloseTag weTag";
														
															case ' ':
																stream.eatSpace();
																if(stream.peek() == ">"||stream.peek() == "/"){
																	continue;
																}
																return "weOpenTag weTag weTag_"+state.tagName;
														}
														if(ch==" "||ch=="/"||ch==">"){
															active=false;
														}else{
															name+=ch;
														}
													}
											
											
											
												}
												if(!stream.eol()&& stream.peek()=="<"){
													stream.next();
												}
												if(!stream.skipTo("<")){
													stream.skipToEnd();
												}
												return null;
											}
										}
									};
									return CodeMirror.overlayParser(CodeMirror.getMode(config, parserConfig.backdrop || "application/x-httpd-php"), webeditionOverlay);
								});
								var editor = CodeMirror.fromTextArea(document.getElementById("code"), {mode: "text/weTmpl"});
							</script>

							<p>Demonstration of a mode that parses HTML, highlighting
							the <a href="http://mustache.github.com/">Mustache</a> templating
							directives inside of it by using the code
							in <a href="../lib/overlay.js"><code>overlay.js</code></a>. View
							source to see the 15 lines of code needed to accomplish this.</p>

							</body>
							</html>
